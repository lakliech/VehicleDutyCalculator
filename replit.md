# Kenya Motor Vehicle Duty Calculator

## Overview

This is a full-stack web application that calculates Kenya Revenue Authority (KRA) import duties and taxes for motor vehicles. The application implements the official KRA valuation formula for various vehicle categories, including depreciation rates for both direct imports and previously registered vehicles. The application features a modern React frontend with shadcn/ui components and an Express.js backend.

## System Architecture

### Frontend Architecture
- **Framework**: React 18 with TypeScript
- **Styling**: Tailwind CSS with shadcn/ui component library
- **State Management**: React Query (@tanstack/react-query) for server state
- **Form Handling**: React Hook Form with Zod validation
- **Routing**: Wouter for client-side routing
- **Build Tool**: Vite for fast development and optimized builds

### Backend Architecture
- **Framework**: Express.js with TypeScript
- **Database**: PostgreSQL with Drizzle ORM
- **Database Provider**: Neon Database (@neondatabase/serverless)
- **Validation**: Zod schemas shared between frontend and backend
- **API**: RESTful endpoints for duty calculation and history retrieval
- **Storage**: DatabaseStorage class handles all database operations

### Project Structure
- `client/` - React frontend application
- `server/` - Express.js backend API
- `shared/` - Shared schemas and types between frontend and backend
- `migrations/` - Database migration files

## Key Components

### Database Schema
- **vehicles**: Stores vehicle information with Kenya-specific fields including category, value, age, import type
- **calculations**: Stores calculation results linked to vehicles with all tax components
- **depreciation_rates**: Stores depreciation rates for different import types and age ranges
- **tax_rates**: Stores tax rates (import duty, excise duty, VAT, RDL, IDF) for each vehicle category
- **vehicle_category_rules**: Stores rules for automatic vehicle category detection based on engine size and fuel type
- **vehicle_references**: Stores the comprehensive vehicle database with make, model, engine capacity, and CRSP values

### API Endpoints
- `POST /api/calculate-duty` - Calculate import duties and taxes for a vehicle using KRA formulas
- `GET /api/calculations/history` - Retrieve calculation history with vehicle details

### Frontend Components
- **DutyCalculator**: Main page with comprehensive form for Kenya vehicle duty calculation
- **UI Components**: Comprehensive set of shadcn/ui components with Kenya-themed green color scheme
- **Form Validation**: Zod schemas ensure data integrity for Kenya-specific requirements

## Vehicle Categories
The calculator supports all major Kenya vehicle import categories:
- **Under 1500cc**: Standard vehicles with engine capacity below 1500cc
- **Over 1500cc**: Vehicles with engine capacity 1500cc and above
- **Large Engine**: Petrol >3000cc or Diesel >2500cc (higher tax rates)
- **Electric**: Fully electric vehicles (reduced import duty and excise duty)
- **School Bus**: Designated student transport vehicles
- **Prime Mover**: Heavy duty truck heads
- **Trailer**: Transport trailers
- **Ambulance**: Emergency medical vehicles (no import duty)
- **Motorcycle**: Two-wheeled vehicles (fixed excise duty)
- **Special Purpose**: Specialized vehicles
- **Heavy Machinery**: Construction and industrial equipment

## Tax Components
The calculator computes the following Kenya-specific taxes (Updated per KRA official rates):
1. **Import Duty**: 
   - Under 1500cc: 35%
   - 1500cc-3000cc (petrol) / 1500cc-2500cc (diesel): 35%
   - Over 3000cc (petrol) / Over 2500cc (diesel): 35%
   - Electric: 25%
   - School Bus: 35%
   - Prime Mover: 25%
   - Trailer: 35%
   - Ambulance: 0%
2. **Excise Duty**: 
   - Under 1500cc: 20%
   - 1500cc-3000cc (petrol) / 1500cc-2500cc (diesel): 20%
   - Over 3000cc (petrol) / Over 2500cc (diesel): 35%
   - Electric: 10%
   - School Bus: 25%
   - Prime Mover: 0%
   - Trailer: 0%
   - Ambulance: 25%
3. **VAT**: 16% on the cumulative value
4. **Railway Development Levy (RDL)**: 2% for direct imports only
5. **Import Declaration Fee (IDF)**: 2.5% for direct imports only

## Depreciation Rates
The system implements updated depreciation rates:
- **Direct Imports**: 
  - 0-6 months: 5%
  - Over 6 months to 1 year: 10%
  - >1 ≤2 years: 25%
  - >2 ≤3 years: 35%
  - >3 ≤4 years: 45%
  - >4 ≤5 years: 55%
  - >5 ≤6 years: 60%
  - >6 ≤7 years: 60%
  - >7 ≤8 years: 65%
- **Previously Registered**: Higher depreciation from 20% (1 year) to 95% (over 15 years)

## Data Flow

1. User selects vehicle category and enters details (value, age, import type)
2. Form data is validated using Kenya-specific Zod schemas
3. Data is sent to backend API for duty calculation
4. Backend applies depreciation based on vehicle age and import type
5. Calculation is performed using KRA formulas for the specific vehicle category
6. Results include customs value, all applicable taxes, and total payable amount
7. Detailed breakdown is displayed showing each tax component

## External Dependencies

### Frontend Dependencies
- React ecosystem (React, React DOM, React Router)
- UI library (Radix UI components via shadcn/ui)
- Form handling (React Hook Form, Hookform Resolvers)
- HTTP client (built-in fetch with React Query)
- Styling (Tailwind CSS, class-variance-authority)

### Backend Dependencies
- Express.js server framework
- Drizzle ORM for database operations
- Neon Database serverless driver
- Zod for schema validation
- PostgreSQL session storage (connect-pg-simple)

### Development Dependencies
- Vite for build tooling
- TypeScript for type safety
- ESBuild for server bundling
- Tailwind CSS for styling
- PostCSS for CSS processing

## Deployment Strategy

### Build Process
- Frontend: Vite builds optimized static assets to `dist/public`
- Backend: ESBuild bundles server code to `dist/index.js`
- Database: Drizzle migrations handle schema changes

### Environment Variables
- `DATABASE_URL`: PostgreSQL connection string (required)
- `NODE_ENV`: Environment setting (development/production)

### Startup
- Development: `npm run dev` - starts server with hot reload
- Production: `npm run build && npm start` - builds and starts production server

## Changelog

Changelog:
- January 13, 2025. Fixed vehicle import calculator functionality:
  - Resolved API call issue by replacing inefficient internal fetch with direct storage method
  - Fixed form validation preventing submission by adding proper default values
  - Removed debugging code and test buttons after confirming functionality
  - Import calculator now correctly processes CIF conversion, duty calculations, and total cost breakdowns
  - Verified working with multiple vehicle examples (Honda Fit, BMW 116i) with proper CRSP value lookup
- July 06, 2025. Initial setup
- January 09, 2025. Converted to Kenya Motor Vehicle Duty Calculator using official KRA valuation formulas and tax rates
- January 10, 2025. Updated vehicle selection flow:
  - Removed manual vehicle category selection
  - Made engine size required for all calculations
  - Vehicle category now auto-detects based on engine size
  - Fixed vehicle model dropdown issues
  - Modified workflow to fetch engine sizes from database
  - Replaced vehicle age field with year of manufacture selector
  - Workflow: Select make → Select model → Select engine size (from database) → Select year of manufacture → Auto-calculate duty with CRSP
  - Removed toggle option - database is now the only entry point for vehicle selection
  - CRSP field is always disabled and automatically populated from database
- January 10, 2025. Stored computation logic in database:
  - Created depreciation_rates table to store age-based depreciation rates
  - Created tax_rates table to store category-specific tax percentages
  - Created vehicle_category_rules table for automatic category detection
  - Updated DatabaseStorage to fetch rates from database instead of hardcoded values
  - Allows dynamic configuration of tax rates without code changes
- January 10, 2025. Added Nexa logo to frontend:
  - Integrated Nexa company logo in the header
  - Responsive design: Full logo with title on desktop, compact view on mobile
  - Professional branding with "discover what is possible" tagline
- January 10, 2025. Fuel type from database:
  - Removed manual fuel type selection field
  - Fuel type now automatically fetched from vehicle database
  - Normalized all fuel types to lowercase in database
  - Vehicle category detection uses fuel type from selected vehicle
- January 10, 2025. UI improvements:
  - Grouped all selection dropdowns (vehicle, year, import type) in one area
  - Removed CRSP input textbox - values only from database
  - CRSP displays within selection area when vehicle is selected
  - Enhanced visual grouping with gray background container
- January 10, 2025. Form validation and workflow updates:
  - Added mandatory validation for all fields before calculation
  - Import Type selection moved to Step 1 
  - Year of Manufacture limited to 8 years for Direct Import, 20 years for Previously Registered
  - Clear visual indicators with red asterisks (*) for required fields
  - Error messages displayed when attempting to calculate without selecting all fields
- January 10, 2025. Fixed depreciation rate calculation logic:
  - Corrected SQL comparison from string to numeric for age calculations
  - Fixed depreciation rate ranges per KRA requirements:
    - >6 but <7 years: 60% depreciation
    - >=7 but <=8 years: 65% depreciation
  - Ensures vehicles aged exactly 7 years get 65% depreciation
  - Numeric comparisons prevent string sorting issues (e.g., "10" < "2")
- January 10, 2025. Updated tax rates per official KRA template:
  - Import Duty: All standard vehicles now 35% (except Electric 25%, Prime Mover 25%, Ambulance 0%)
  - Excise Duty: Under 3000cc petrol/2500cc diesel now 20%, over these limits 35%
  - Electric vehicles: 25% import duty, 10% excise duty
  - Prime Movers and Trailers: 0% excise duty
  - All rates updated to match KRA Motor Vehicle Valuation Template effective July 2023
- January 10, 2025. Added emoji-based vehicle category selector:
  - Created VehicleCategorySelector component with visual emoji icons for each category
  - Added toggle to switch between auto-detection and manual category selection
  - Each category card shows emoji, description, and applicable tax rates
  - Manual selection overrides auto-detection based on engine size
  - Enhanced user experience with visual category identification
- January 10, 2025. Implemented category conflict validation:
  - Added validation to prevent manual category selection from conflicting with vehicle specs
  - Real-time conflict warnings for engine size mismatches (e.g., selecting "Under 1500cc" for 2000cc vehicle)
  - Fuel type validation (e.g., prevents selecting "Electric" for petrol vehicles)
  - Body type checks for specialized categories (motorcycle, bus, ambulance)
  - Form submission blocked when conflicts exist with clear error messages
  - Conflicts automatically clear when switching back to auto-detection mode
- January 10, 2025. Added CRSP2020 comprehensive vehicle coverage:
  - Added 634 new vehicles from CRSP2020 CSV to database (total now 3,504 vehicles)
  - Implemented fallback system: Current CRSP_KES takes priority, falls back to CRSP2020
  - Added visual indicators (orange badges) when 2020 CRSP values are used
  - Warning messages inform users that 2020 prices may differ from current market
  - Enhanced calculation results and toast notifications to indicate CRSP source
  - Created add-missing-vehicles.ts script for future vehicle database expansions
- January 10, 2025. Enhanced admin dashboard with comprehensive management features:
  - Added additional columns to vehicle table (GVW, CRSP 2020 with visual indicators)
  - Implemented vehicle editing functionality with comprehensive form including all fields
  - Added vehicle deletion capability with confirmation prompts and proper cleanup
  - Created tax rate addition functionality allowing admins to add new vehicle categories
  - Enhanced backend with PUT/DELETE endpoints for vehicle management and POST for tax rates
  - Updated validation schemas to include crsp2020 and discontinuationYear fields
  - Improved UX with edit/delete buttons, dialogs, and proper error handling
- January 10, 2025. Implemented CRSP proration for vehicles not in database:
  - Added manual entry mode in vehicle selector with toggle between database and manual entry
  - Users can input make, model, and engine capacity for vehicles not in database
  - System searches for reference vehicles from same make with CRSP values and engine capacity
  - Prorates CRSP value using formula: reference_crsp × manual_engine_capacity ÷ reference_engine_capacity
  - Example: Peugeot 2008 (1200cc) uses Peugeot 3008 (1598cc) reference: 5,499,000 × 1200 ÷ 1598
  - Enhanced UI with proration calculation display and clear data source indicators
  - Updated backend search endpoint to filter reference vehicles with valid CRSP and engine data
  - Integrated manual vehicle data into duty calculation workflow with appropriate notifications
- January 10, 2025. Complete branding transformation to Gariyangu:
  - Updated from Nexa to Gariyangu branding with new logo integration
  - Implemented Satoshi font throughout the application for modern typography
  - Transformed color scheme from green theme to purple/cyan palette:
    - Primary: Purple (hsl(267, 83%, 57%))
    - Secondary: Cyan (hsl(196, 100%, 85%))
    - Gradients: Purple header gradients and purple-to-cyan contact section
  - Updated all UI components including headers, buttons, badges, and backgrounds
  - Enhanced visual hierarchy with gradient backgrounds (purple-to-cyan on pages)
  - Updated tagline from "discover what is possible" to "All About Cars"
- January 10, 2025. Added professional car import contact integration:
  - Implemented WhatsApp contact section below header with car import services promotion
  - Direct WhatsApp link with pre-filled message for car import inquiries
  - Contact information: 0736 272719 for Japan/UK/South Africa/Dubai/Australia/Singapore/Thailand imports
  - Professional styling with gradient background and responsive design
  - Clear call-to-action for users interested in car import services
- January 10, 2025. Fixed category validation system:
  - Completely resolved issue where multiple conflicting categories could be selected
  - Enhanced validation with comprehensive conflict detection for Electric vs petrol/diesel
  - Added specialized category validation for Prime Mover, Trailer, School Bus, etc.
  - Submit button now disables when conflicts exist with clear error messages
  - Updated Gariyangu purple/cyan branding throughout category selector
- January 10, 2025. Updated depreciation rates and age calculation:
  - Modified depreciation rates to match user specifications: 2018 (65%), 2019 (60%), 2020 (55%)
  - Updated age calculation to always add 1 year: age = current_year - manufacture_year + 1
  - Adjusted intermediate depreciation rates for consistent progression
  - Updated documentation to reflect new depreciation schedule
- January 10, 2025. Updated Railway Development Levy (RDL) to 2%:
  - Changed RDL rate from 1.5% to 2% across all system components
  - Updated backend storage calculations and breakdown descriptions
  - Modified PDF generator to display 2% RDL rate
  - Updated database processing fees and computation tables
  - Updated all documentation to reflect new 2% RDL rate
- January 10, 2025. Updated brand identity and logo:
  - Changed logo from gariyangu_1751901637375.png to gylogo_1752064168868.png
  - Updated logo sizing to meet minimum requirement of 250x150px
  - Applied new color scheme (#ffffff, #381072, #740a72, #b10573, #ee0074) throughout application
  - Updated header heights and spacing to accommodate larger logo
  - Modernized color scheme in both light and dark modes
  - Updated PDF generator to use new logo and color scheme with full brand colors
  - Applied consistent branding across admin dashboard and main calculator
  - Enhanced PDF styling with gradient effects and modern color palette
- January 10, 2025. Implemented comprehensive Vehicle Transfer Cost Calculator:
  - Created complete database schema for vehicle transfer rates with engine capacity ranges
  - Imported official transfer rates for vehicles (1000cc & below: 2,210/= to 3001cc+: 6,465/=), trailers, and tractors
  - Built comprehensive transfer cost calculation API endpoint with government fees, legal fees, and additional costs
  - Developed fully functional transfer cost calculator page with vehicle selection interface
  - Integrated vehicle, trailer, and heavy machinery selectors for accurate rate determination
  - Added detailed cost breakdown display with categorized fee structures and grand total calculations
  - Implemented transfer process timeline and required documents guide for user education
  - Included comprehensive notes and disclaimers for accurate user expectations
  - Applied consistent Gariyangu branding with purple-cyan color scheme throughout transfer module
- January 10, 2025. Enhanced Vehicle Transfer Cost Calculator:
  - Fixed broken filters in vehicle selector by restructuring query keys and adding proper category filtering
  - Renamed "Manual Entry with Proration" to "Enter Vehicle manually" as requested
  - Removed vehicle value option from transfer cost calculator form
  - Removed fee tiles at bottom of transfer cost page for cleaner UI
  - Improved query structure in VehicleSelector with proper queryFn functions and category support
  - Enhanced cache management with more specific query keys to avoid conflicts
- January 10, 2025. Streamlined VehicleSelector and Sell My Car page:
  - Completely removed manual vehicle entry functionality from VehicleSelector component for simplified database-only selection
  - Removed "Select Your Vehicle" title from Sell My Car page for cleaner UI
  - Moved listing title field to top of form, now appears before vehicle selection
  - Removed vehicle selection confirmation card and additional vehicle info display (seating, GVW)
  - Simplified VehicleSelector interface to only support database vehicle selection with automatic engine size handling
  - Enhanced form flow with listing title positioned prominently at the start
- January 10, 2025. Fixed transfer cost calculator issues:
  - Resolved API call parameter order error in frontend (apiRequest expects method, url, data)
  - Populated empty vehicle database with 2,836 vehicle records from import scripts
  - Imported 11 transfer rates for proper cost calculations
  - Populated all computation tables (depreciation rates, tax rates, vehicle category rules)
  - Vehicle make and model selection now returns proper results for all vehicle types
- January 10, 2025. Added specialized equipment databases:
  - Created trailers table with 28 records from trailers CSV data
  - Created heavy_machinery table with 112 records from tractors/equipment CSV data
  - Imported comprehensive equipment data including CRSP values, specifications, and categories
  - Added automated import scripts for both databases with data cleaning and categorization
  - Extended database schema to support trailers and heavy machinery duty calculations
- January 10, 2025. Fixed category validation and Heavy Machinery logic:
  - Removed duplicate category selection section from frontend for cleaner UX
  - Updated validation logic to work with category-first selection flow
  - Fixed Heavy Machinery validation that was incorrectly checking for regular vehicles
  - Category validation now properly handles all three equipment types: vehicles, trailers, heavy machinery
  - Year of manufacture validation now skips trailers and heavy machinery (not required)
  - Submit button correctly disables when category conflicts exist across all equipment types
- January 10, 2025. Fixed RDL and IDF calculations:
  - Corrected Railway Development Levy (RDL) to use 2% of customs value instead of VAT value
  - Corrected Import Declaration Fee (IDF) to use 2.5% of customs value instead of VAT value
  - Updated breakdown descriptions to clearly show percentages and calculation base
  - Ensured compliance with proper duty calculation standards
- January 10, 2025. Fixed CRSP proration submit button issue:
  - Resolved bug where calculate duty button was disabled after proration
  - Category validation was incorrectly using reference vehicle's engine capacity instead of manual vehicle's capacity
  - Updated validation logic to use manual vehicle's engine capacity when in proration mode
  - Proration functionality now works correctly from manual entry to duty calculation
- January 10, 2025. Repositioned app as automotive tools aggregator:
  - Added top navigation menu bar with multiple automotive tools
  - Created placeholder pages for Vehicle Importation Estimator, Vehicle Service Estimator, and Vehicle Transfer Cost
  - Restructured app architecture with Navigation component and updated routing
  - Motor Vehicle Duty Calculator is now one tool among four in the aggregator
  - Updated branding to position as comprehensive automotive tools platform
  - Enhanced user experience with modern navigation and tool categorization
- January 10, 2025. Transformed into Kenya's Car Marketplace:
  - Changed branding from "Automotive Tools" to "Kenya's Car Marketplace"
  - Increased logo size for better visibility and brand presence
  - Separated MyCar's Worth and Transfer Cost into distinct tools
  - Added "Sell My Car" marketplace functionality page
  - Created comprehensive home page with hero section, featured tools, and company contact
  - Moved duty calculator from root (/) to inner page (/duty-calculator)
  - Expanded navigation to 7 tools: Duty Calculator, Import Calculator, Service Estimates, MyCar's Worth, Transfer Cost, Sell My Car, Vehicle Loan Products
  - Enhanced home page with marketplace positioning, WhatsApp contact integration, and professional landing experience
- January 10, 2025. Frontend reorganization and admin link relocation:
  - Simplified home page to display only basic information and clean menu tiles for all 8 automotive tools
  - Moved admin link from duty calculator module to static header section for global access across all pages
  - Reorganized home page layout with single grid of tool tiles instead of separate featured/all tools sections
  - Enhanced navigation header with admin button positioned permanently in top-right corner
  - Admin link now accessible on all module pages ensuring consistent administrative access throughout platform
- January 10, 2025. Completed ModuleNavigation component implementation:
  - Created comprehensive ModuleNavigation component with cross-module navigation and authentication links
  - Added ModuleNavigation to all 8 module pages: duty-calculator, transfer-cost, importation-estimator, service-estimator, mycars-worth, sell-my-car, buy-a-car, vehicle-loans
  - Implemented clean, compact design with purple-themed styling consistent with Gariyangu branding
  - Each module page now includes small navigation menu linking to other modules with Login/Register functionality
  - Achieved complete separation between static header navigation and module-specific cross-navigation
  - Resolved all JSX syntax errors and confirmed application runs successfully with new navigation structure
- January 10, 2025. Integrated Google OAuth authentication:
  - Successfully implemented complete Google OAuth flow using provided client credentials (955395502828-pj4cbgcrkkehsjcsigst2jcn60t9qttm.apps.googleusercontent.com)
  - Added passport-google-oauth20 and googleapis packages for secure OAuth implementation
  - Created Google OAuth strategy with automatic user creation for new Google accounts
  - Updated authentication provider to check OAuth session status on app initialization
  - Added Google OAuth endpoints (/api/auth/google, /api/auth/google/callback) with proper error handling
  - Integrated OAuth success/failure notifications with toast messages on home page
  - Enhanced logout functionality to clear both client and server sessions
  - Users can now register and login seamlessly using their Google accounts without separate registration flow
- January 10, 2025. Enhanced vehicle listing form with authentication requirements:
  - Implemented comprehensive authentication checks before allowing vehicle listing creation
  - Added authentication required banner with clear Google sign-in call-to-action for unauthenticated users
  - Disabled all form inputs and submission when user is not authenticated to prevent incomplete submissions
  - Updated form validation to redirect unauthenticated users directly to Google OAuth flow
  - Enhanced user experience with visual feedback showing authentication status and requirements
  - Moved photo upload to top of form for better workflow with main image selection functionality
- January 10, 2025. Added interactive authentication with social login logos:
  - Implemented authentication popup triggers on key form interactions (photo upload, title field focus, form submission)
  - Added social login options with branded logos (Google, Facebook, Apple) in both registration and login dialogs
  - Replaced text-based social login buttons with proper SVG logos using official brand colors
  - Enhanced user experience with visual dividers ("or continue with") and grid layout for social options
  - Removed form field disabling for better UX - authentication prompts appear on interaction instead
- January 10, 2025. Enhanced vehicle listing form with database schema improvements:
  - Added drive configuration field to database and form with 2WD, 4WD, AWD options
  - Changed single "color" field to separate "exterior color" and "interior color" fields
  - Created reference tables for colors and drive configurations with 27 exterior colors and 15 interior colors
  - Populated database with common color options and drive configuration reference data
  - Reorganized vehicle listing form to continuous flow layout instead of grid-based sections
  - Updated all form sections (Vehicle Details, Pricing, Location, Features, Contact) to vertical space-y-4 layout
  - Enhanced form flow with features displayed as flexible wrapped items for better space utilization
- January 10, 2025. Implemented database-based admin authentication:
  - Removed hardcoded admin password (admin123) as environment variable
  - Created admin_credentials table with username, password_hash, and permissions fields
  - Added admin authentication methods to storage interface and DatabaseStorage class
  - Created default admin account with username "admin" and password "admin123" (changeable via database)
  - Implemented admin login, logout, and status endpoints for secure authentication
  - Added bcrypt password hashing for secure credential storage
  - Maintained backward compatibility with old "admin123" token during transition period
  - Enhanced admin authentication middleware to support both legacy and database-based authentication
- January 11, 2025. Restored CRSP proration functionality:
  - Fully restored manual vehicle entry with proration calculations in VehicleSelector component
  - Added toggle switch between database selection and manual entry modes
  - Implemented comprehensive proration calculation using formula: reference_crsp × manual_engine_capacity ÷ reference_engine_capacity
  - Added reference vehicle search functionality for same make with valid CRSP values
  - Enhanced UI with detailed proration calculation breakdown and reference vehicle information
  - Integrated manual vehicle data properly with duty calculator for seamless processing
  - Added visual feedback with calculation formula display and data source indicators
  - Restored all original proration features including error handling and validation
- January 11, 2025. Implemented AI-powered Vehicle Recommendation Chatbot:
  - Created comprehensive chatbot using OpenAI GPT-4o for personalized vehicle recommendations
  - Built VehicleChatbot component with conversation history and real-time messaging
  - Integrated vehicle database for accurate pricing and recommendation validation
  - Added dedicated AI Advisor page with features sidebar and tips section
  - Implemented backend API endpoint with context-aware AI responses and JSON formatting
  - Enhanced chatbot with vehicle selection capability for seamless integration with other tools
  - Added visual recommendations cards with pricing, suitability, and selection functionality
- January 11, 2025. Created Price Trend Heatmap Analytics Module:
  - Implemented interactive visualization using Recharts for vehicle pricing trends
  - Built comprehensive scatter plot heatmap with color-coded market insights and demand analysis
  - Added filtering capabilities by vehicle make and price category (budget/mid-range/premium/luxury)
  - Created market intelligence features including demand level analysis and trend indicators
  - Integrated real vehicle database with CRSP pricing for authentic market data visualization
  - Added responsive design with sidebar containing filters, color legend, and market insights
  - Enhanced analytics with tooltips showing detailed vehicle information and trend indicators
  - Created public API endpoint for vehicle references to support analytics without admin authentication
- January 11, 2025. Enhanced UI with modern styling and comprehensive navigation:
  - Updated home page tool cards with modern glassmorphism effects, hover animations, and enhanced shadows
  - Implemented sophisticated card hover effects including lift animations, gradient overlays, and icon rotations
  - Added ModuleNavigation component to AI Advisor page to ensure consistent navigation across all module pages
  - Verified all 8 module pages now have comprehensive cross-module navigation functionality
  - Enhanced visual hierarchy with modern rounded corners, backdrop blur effects, and gradient buttons
- January 11, 2025. Cleaned admin dashboard from frontend marketplace elements:
  - Removed "Back to Calculator" button from admin dashboard header for backend-focused design
  - Fixed Link import error that occurred during cleanup
  - Maintained proper admin authentication, logout functionality, and navigation tabs
  - Admin dashboard now focuses purely on backend administration without frontend marketplace elements
- January 11, 2025. Removed promotional elements from admin pages:
  - Added conditional logic to Navigation component to detect admin pages
  - Hidden car import promotional text ("Do you wish to import a car...") on admin pages
  - Hidden Login/Register (AuthForms) component on admin pages for cleaner backend-focused interface
  - Admin pages now display only essential navigation without frontend marketplace elements
- January 12, 2025. Implemented role-based authentication system:
  - Disabled legacy admin authentication (admin123 tokens and separate admin credentials)
  - Created comprehensive role-based access control with 4 roles: user, editor, admin, superadmin
  - Updated all admin endpoints to use authenticateUser and requireRole middleware
  - Created initialization script to set up default roles and admin user
  - Admin credentials for testing: admin@gariyangu.com / admin123 (admin role)
  - All admin access now requires Google OAuth authentication with appropriate role assignment
  - Removed separate admin login system in favor of unified user authentication with role permissions
  - Updated admin user management: jaredkoyier@gmail.com now has admin role, removed admin@gariyangu.com test user
  - Admin users are now created through Google OAuth with manual role assignment
- January 11, 2025. Implemented personalized vehicle insurance quote estimator:
  - Created comprehensive database schema for insurance quotes with risk factors and coverage details
  - Built sophisticated risk calculation algorithm considering driver age, experience, claims history, vehicle category, and location
  - Integrated with existing vehicle database for seamless quote generation
  - Added detailed premium breakdown and personalized recommendations based on Kenya insurance market factors
  - Hidden from frontend navigation per user request for future implementation
- January 11, 2025. Completed comprehensive Vehicle Import Estimator:
  - Implemented full-stack import cost calculator with CIF conversion (USD/JPY/GBP to KES)
  - Created database schema for import estimates, exchange rates, and clearing charges
  - Built backend API endpoints for exchange rates, clearing charges, and import calculations
  - Developed comprehensive frontend interface with vehicle selection and detailed cost breakdown
  - Fixed calculation formula: CIF Price + Duty + Clearing Fees + Transport + 5% of total cost (service fee calculated as percentage of final total)
  - Integrated with existing duty calculator for accurate tax computation
  - Added automatic vehicle category detection based on engine capacity
- January 11, 2025. Implemented comprehensive My Listings and My Wishlists pages:
  - Created fully functional My Listings page with stats overview, performance metrics, and listing management
  - Implemented My Wishlists page with dual tabs for Favorite Cars and Saved Searches
  - Added user navigation menu items for easy access to personal pages
  - Fixed wishlist data structure errors by resolving backend-frontend mapping issues
  - Implemented proper JSON parsing for saved search filters with error handling
  - Added React Query integration with correct API response structure handling
  - Removed duplicate header sections from both pages to prevent duplication with main Navigation component
  - Removed ModuleNavigation component from both pages to fix logo duplication, keeping only main Navigation with logo
  - Fixed header duplication issue by removing Navigation component from individual pages since it's already rendered globally in App.tsx
- January 13, 2025. Fixed critical car details and admin meta update issues:
  - Resolved car details route to fetch real database data instead of limited mock data
  - Fixed syntax errors by removing obsolete mock data structures causing conflicts
  - Enhanced car details API to join car listings with seller information for complete data
  - Identified and fixed "Failed to update meta fields" validation error
  - Added "inactive" status to adminMetaUpdateSchema validation for proper admin functionality
  - Removed "flagged", "sold", and "verified" status options from admin interface dropdown per user request
  - Updated status options to: pending, active, inactive, rejected, archived
  - Enhanced admin listing details page with proper status validation and error handling
- January 13, 2025. Enhanced flag listing implementation with comprehensive reason categories:
  - Created comprehensive flag dialog with 25 detailed reason options across 5 categories
  - Added Content Issues: inappropriate images, blurry photos, stolen images, watermarked content, misleading photos
  - Added Misleading Information: incorrect specs, fake mileage, wrong pricing, non-existent vehicles, misrepresentation
  - Added Suspicious Activity: scams, upfront payments, duplicates, stolen vehicles, VIN mismatches
  - Added Seller Behavior: unresponsive sellers, rude communication, off-platform requests, fake details, impersonation
  - Added Platform Violations: banned items, prohibited keywords, external links, spam listings, fee bypass attempts
  - Enhanced backend to capture additional notes with flag reasons for better context
  - Updated flag mutation to support detailed reason selection and optional administrative notes
- January 13, 2025. Implemented automatic listing hiding for suspended users:
  - Added database schema support with status field for app_users table (active/suspended/pending)
  - Enhanced car-listings API endpoint to filter out listings from suspended users automatically
  - Updated database queries to join with app_users table and exclude suspended sellers
  - Verified that listings from suspended users are completely hidden from buy-a-car module
  - Integrated with user management bulk actions for immediate listing visibility control
- January 13, 2025. Enhanced automated flagging system with user account suspension:
  - Updated executeAutomatedAction method to include user-level suspension for critical violations
  - Added automatic user suspension for scam_phishing_attempt, impersonation_fake_profile, stolen_vehicle, fraud, and copyright violations
  - Implemented suspendUserAccount, markUserHighRisk, and notifyLegalTeam helper methods
  - Verified automated flagging triggers user suspension which immediately hides all user listings from marketplace
  - Critical auto-flag rules now properly suspend user accounts in addition to listing actions
  - System automatically integrates user suspension with existing listing visibility controls
- January 13, 2025. Enhanced messaging system for distinct user conversations:
  - Modified conversation creation logic to always create separate conversations for each inquiry
  - Removed conversation reuse that was merging different users' inquiries about same listing
  - Enhanced getUserConversations to include participant information and sender names in conversation list
  - Updated messaging stats API to include unreadCount field with proper calculation
  - Added unread message count badges to navigation menu with real-time polling every 30 seconds
  - Separated existing merged conversations from Chris Otieno and Jane Smith into distinct conversations
  - Each user now has their own private conversation thread with sellers for better message organization
  - Fixed duplicate Navigation components on Messages page by removing local Navigation import
  - Messages page now uses only the global Navigation from App.tsx, eliminating duplicate headers and call-to-action sections
- January 13, 2025. Added Inquiries button to My Listings page:
  - Created new API endpoint `/api/listing/:listingId/conversations` to fetch listing-specific conversations
  - Added "Inquiries" button next to Analytics button on each listing in My Listings page
  - Implemented comprehensive inquiries dialog showing all conversations for selected listing
  - Dialog displays participant names, last messages, unread counts, and message statistics
  - Added "View Chat" button linking directly to specific conversations in Messages page
  - Enhanced listing management with direct access to buyer inquiries and conversation tracking
- January 13, 2025. Enhanced Inquiries button with unread message counts and direct navigation:
  - Added `/api/user/listings/conversation-counts` endpoint for real-time unread message tracking
  - Inquiries button now displays red badge with unread message count for each listing
  - Made inquiry cards in popup clickable - clicking navigates directly to Messages page
  - Implemented 30-second auto-refresh for conversation counts to show real-time updates
  - Removed separate "View Chat" button in favor of making entire card clickable for better UX
  - Dialog automatically closes when user clicks on a conversation to navigate to Messages
- January 13, 2025. Fixed AI Advisor chatbot issues:
  - Removed duplicate ModuleNavigation component causing double navigation bars
  - Fixed API response parsing in VehicleChatbot component by adding proper .json() call
  - Improved timestamp formatting to display proper time format (hour:minute AM/PM)
  - Added fallback text handling for empty message content
  - Enhanced error handling and response parsing with proper fallbacks
  - Verified OpenAI GPT-4o integration working correctly with vehicle recommendations
- January 13, 2025. Enhanced AI Advisor with comprehensive vehicle action modal:
  - Replaced "SELECT THIS CAR" button with "View Options" button that opens action modal
  - Created comprehensive modal with three vehicle actions: Find Car, Import Cost, and Show Specs
  - Find Car option navigates to Buy A Car page with pre-applied filters (make, model, price range)
  - Import Cost option navigates to Import Estimator with pre-filled vehicle details
  - Show Specs option displays vehicle specifications in alert dialog
  - Added URL parameter handling in Buy A Car page to accept AI Advisor recommendations
  - Added URL parameter handling in Import Estimator page to pre-fill vehicle details
  - Enhanced user experience with seamless transitions between AI recommendations and marketplace tools
- January 13, 2025. Redesigned home page for lean and tidy experience:
  - Completely simplified home page layout removing complex animations and excessive styling
  - Streamlined to clean white/gray design with focused messaging
  - Reduced tool sections to 4 core tools (Duty Calculator, Buy Car, Sell Car, AI Advisor) prominently displayed
  - Added compact grid of 6 additional tools as secondary navigation
  - Simplified hero section with clear value proposition and primary action buttons
  - Maintained essential contact section for import services
  - Improved performance by removing complex gradient animations and effects
  - Enhanced with larger icons: core tools use 10x10 icons, additional tools use 6x6 icons for better visual impact
- January 13, 2025. Enhanced navigation and footer improvements:
  - Added navigation menu to header with About Us and Careers links positioned in the header section
  - Created comprehensive About Us page with company mission, values, features, and contact information
  - Created detailed Careers page with job openings, benefits, hiring process, and application options
  - Restructured Login/Register display for better user experience with responsive design
  - Reduced footer size significantly: decreased padding from py-12 to py-6, reduced font sizes to text-xs/text-sm
  - Made footer more compact with smaller icons (h-3 w-3) and reduced spacing throughout
  - Reduced blank spaces on home page: cut section padding by 50% (py-16 to py-8), smaller fonts, tighter grid spacing
- January 13, 2025. Implemented comprehensive Vehicle Seller Analytics System:
  - Created extensive database schema with 8+ new analytics tables (listing_views, search_impressions, market_benchmarks, listing_quality_scores, search_keywords, promotion_tracking, listing_recommendations)
  - Enhanced daily_listing_analytics table with comprehensive tracking fields including unique visitors, device breakdown, location analysis, traffic sources, and active hours
  - Built detailed ListingAnalytics page with 5 comprehensive tabs: Performance, Audience, Market, Quality, Keywords
  - Implemented backend API endpoint `/api/listing/:listingId/analytics` for comprehensive seller analytics data retrieval
  - Added visual charts and insights using Recharts including performance metrics, engagement breakdown, audience demographics, market benchmarking, and quality indicators
  - Fixed Analytics button navigation in My Listings page with proper onClick handler to navigate to `/listing/:id/analytics`
  - Added seed endpoint `/api/listing/:listingId/seed-analytics` for testing with sample data generation
  - System provides sellers with actionable insights including listing performance trends, buyer engagement metrics, competitive analysis, quality scores with improvement suggestions, and top-performing search keywords
- January 13, 2025. Implemented comprehensive Keyword Analytics System for tracking search terms that lead to listing views and conversions:
  - Created complete KeywordAnalytics class in `server/keyword-analytics.ts` with sophisticated search term tracking and analysis
  - Implemented automatic search impression tracking when listings appear in search results with position and keyword extraction
  - Added search click tracking when users navigate from search results to specific listings with full context preservation
  - Built conversion tracking system for inquiries, phone clicks, favorites, and shares linked to originating search keywords
  - Created intelligent keyword extraction algorithm that filters stop words and identifies meaningful search terms
  - Added comprehensive database integration with search_keywords, search_impressions, and listing_views tables for full analytics pipeline
  - Implemented 5 key API endpoints: conversion tracking, listing keywords, seller analytics, trending keywords, and keyword recommendations
  - Enhanced listing analytics dashboard to include top-performing keywords with search counts, click-through rates, and conversion metrics
  - Added keyword performance analysis across seller's portfolio with aggregated insights and trending term identification
  - System provides data-driven keyword recommendations for listing optimization based on high-performing terms from similar vehicles
  - Integrated keyword analytics into main car listings API to automatically track search impressions and user journey mapping
- January 13, 2025. Implemented Real-Time Analytics Tracking System:
  - Added comprehensive real-time view tracking to `/api/car-listings/:id/details` endpoint with immediate database updates
  - Implemented instant tracking for all user interactions: views, phone clicks, favorites, inquiries, and shares
  - Created 4 dedicated tracking endpoints: `/api/track-phone-click`, `/api/track-favorite`, `/api/track-inquiry`, `/api/track-share`
  - Every user interaction immediately updates `car_listings` view/favorite counts and `daily_listing_analytics` table
  - Added device type detection (mobile/desktop/tablet) and location tracking for comprehensive analytics
  - Integrated keyword conversion tracking with all user actions for complete search-to-conversion attribution
  - Real-time tracking captures: viewer ID, session ID, device type, IP address, user agent, and search context
  - System immediately reflects analytics changes: view counts increment on each listing access, daily analytics update instantly
  - Enhanced console logging shows successful tracking events for debugging and monitoring
  - Complete analytics pipeline from search impression → listing view → user action → conversion tracking
- January 15, 2025. Fixed loan application system authentication and data loading:
  - Added comprehensive authentication protection to loan application pages
  - Fixed vehicle details loading by enabling queries only when authenticated
  - Added authentication checks to "Apply for Loan" buttons in car details page
  - Updated loan product API endpoint routing to prevent conflicts
  - Added proper loading states and error handling for authentication
  - Loan application form now properly captures vehicle details and displays loan terms
  - Only authenticated users can access loan application and tracking features
- January 16, 2025. Implemented comprehensive performance optimization framework:
  - Added Redis caching system with memory cache fallback for high-performance data storage
  - Integrated Sharp image optimization service with WebP conversion and automatic compression
  - Added image optimization API endpoints (/api/images/optimize/*) with intelligent caching
  - Implemented compression middleware for all API responses (gzip level 6)
  - Added caching to frequently accessed endpoints (car listings, filters) with 5-minute TTL
  - Enhanced OptimizedImage component to use server-side optimization endpoints
  - Added cache management endpoints for monitoring and clearing cached data
  - Performance stack: Redis → Memory fallback, Sharp image processing, automatic WebP conversion
  - Cache headers implemented: 1-year cache for images, 5-minute for API responses
  - Lazy loading with intersection observer for images below the fold
- January 16, 2025. Integrated Smart Pricing Intelligence with My Listings functionality:
  - Updated Smart Pricing button in My Listings to open listing-specific pricing dialog instead of general dashboard
  - Created comprehensive Smart Pricing dialog component with real-time market analysis for individual listings
  - Added pricing recommendation API endpoint (/api/listings/:listingId/pricing-recommendation) for per-listing intelligence
  - Fixed database schema column mismatches in Smart Pricing queries (vehicle_category → category)
  - Enhanced pricing dialog with current price analysis, three-tier pricing recommendations (quick sale/recommended/premium)
  - Added market insights display with similar vehicles analysis and seasonal trends
  - Integrated "Apply Recommended Price" functionality for seamless listing price updates
  - Populated Smart Pricing database with seasonal trends, market insights, depreciation forecasts, and market analysis data
  - Smart Pricing now provides actionable, listing-specific recommendations directly from seller's listing management interface
- January 16, 2025. Created comprehensive unified Listing Dashboard for each vehicle listing:
  - Built single-page listing dashboard at `/listing/:id/dashboard` combining all seller management functions
  - Dashboard includes 6 main tabs: Overview, Inquiries, Analytics, Smart Pricing, Manage, and Appointments
  - Overview tab displays listing preview, recent activity, and quick stats (views, inquiries, phone clicks, favorites)
  - Inquiries tab shows all customer conversations with unread counts and direct message navigation
  - Analytics tab provides comprehensive performance metrics, keyword analysis, and engagement breakdown
  - Smart Pricing tab integrates full pricing intelligence with market analysis and price recommendations
  - Manage tab consolidates listing status control, quick actions, and performance summaries
  - Appointments tab prepared for future test drive and video call scheduling features
  - Added prominent purple "Dashboard" button to My Listings page for easy access to comprehensive listing management
  - Unified interface eliminates need to navigate between multiple separate pages for listing management tasks
- January 16, 2025. Redesigned My Listings page for high-volume seller scalability:
  - Transformed from multiple-button interface to clean clickable cards for managing 800+ listings efficiently
  - Removed Dashboard, Inquiries, Appointments, and Smart Pricing action buttons from individual listing cards
  - Made entire listing cards clickable - they now directly navigate to the unified listing dashboard
  - Added visual notification badges showing unread message counts and pending appointment counts
  - Streamlined interface displays "Click to manage →" instead of cluttered button array
  - Scalable design provides intuitive experience for sellers with large listing volumes
  - Fixed Smart Pricing SQL syntax error by correcting deprecationForecast to depreciationForecast in schema
  - Enhanced user experience prioritizes simplicity and quick access to comprehensive management tools
- January 16, 2025. Reorganized listing dashboard to eliminate redundancy and improve workflow:
  - Consolidated 6 tabs into 4 streamlined tabs for better organization
  - Merged "Inquiries" into "Messages & Inquiries" tab for unified communication management
  - Combined "Analytics" and insights into single "Analytics & Insights" tab
  - Integrated Smart Pricing functionality directly into "Manage & Pricing" tab
  - Removed redundant "Full Analytics" and separate "Smart Pricing" tabs
  - Removed "Appointments" tab placeholder for future implementation
  - New structure: Overview, Messages & Inquiries, Analytics & Insights, Manage & Pricing
  - Streamlined interface reduces cognitive load and improves seller workflow efficiency
- January 16, 2025. Enhanced dashboard with restored functionality and improved data loading:
  - Restored Full Analytics functionality with "Full Analytics" button linking to dedicated analytics page
  - Added comprehensive Appointments tab with appointment scheduling, management, and statistics
  - Enhanced Messages & Inquiries tab with nested conversation data, message statistics, and quick actions
  - Added appointment data loading with sample appointments for test drives, inspections, and video calls
  - Improved message statistics showing total conversations, unread messages, response rates, and response times
  - Added quick action buttons for appointment management, scheduling, and calendar integration
  - Enhanced error handling in Smart Pricing service to prevent SQL syntax errors from breaking functionality
  - Dashboard now supports 5 comprehensive tabs: Overview, Messages & Inquiries, Analytics & Insights, Manage & Pricing, Appointments
- January 16, 2025. Enhanced Messages & Inquiries with inline messaging functionality:
  - Removed "View Messages" button and integrated messages directly into customer inquiries section
  - Added inline message display showing recent conversation history for each customer
  - Implemented quick reply functionality with input field and send button for each conversation
  - Added conversation threading with buyer messages on left, seller responses on right
  - Enhanced message display with user avatars, timestamps, and message bubbles
  - Added "View Full Chat" button for accessing complete conversation history
  - Improved quick actions with "Open Full Messages", "Mark All as Read", and "Set Auto-Reply" options
  - Streamlined messaging workflow eliminates need to navigate away from dashboard for basic message management
- January 16, 2025. Fixed authentication multiple attempt issues:
  - Enhanced session management with forced session save in Google OAuth callback
  - Improved session configuration with resave: true and saveUninitialized: true for better reliability
  - Added rolling session expiry reset on each request to maintain active sessions
  - Enhanced authentication middleware with better session validation and error handling
  - Improved client-side authentication with retry logic and progressive backoff
  - Added credentials: 'include' to all auth status checks for proper session handling
  - Enhanced logout functionality to properly clear server sessions with API calls
  - Authentication now works reliably on first attempt without requiring multiple login attempts
- January 16, 2025. Enhanced Analytics & Insights tab with comprehensive full analytics content:
  - Replaced basic analytics view with comprehensive full analytics content from dedicated analytics page
  - Added 5 detailed analytics tabs: Performance, Audience, Market, Quality, and Keywords
  - Enhanced key performance metrics with proper formatting and visual styling (blue, green, purple, orange color scheme)
  - Added comprehensive Performance tab with views trend charts and engagement breakdown metrics
  - Added Audience tab with device usage breakdown, top locations, and peak hours analysis
  - Added Market tab with price analysis, market insights, and competitive positioning
  - Added Quality tab with quality scoring system and improvement suggestions
  - Added Keywords tab with top search keywords and click-through analytics
  - Integrated all analytics data with proper fallback handling for missing data
  - Enhanced visual design with proper card layouts and consistent purple-cyan branding
- January 16, 2025. Fixed data structure mismatch between dashboard and full analytics:
  - Updated dashboard analytics to use correct data structure matching full analytics page
  - Fixed Total Views to use analytics.performanceMetrics.totalViews instead of analytics.totalViews
  - Fixed Unique Visitors to use analytics.performanceMetrics.uniqueVisitors instead of analytics.uniqueVisitors
  - Fixed Inquiries to use analytics.engagementMetrics.inquiries instead of analytics.inquiries
  - Fixed Favorites to use analytics.engagementMetrics.favorites instead of analytics.favorites
  - Fixed Click-Through Rate to use analytics.performanceMetrics.clickThroughRate with proper formatting
  - Fixed Phone Clicks and Shares to use analytics.engagementMetrics data structure
  - Fixed Device Usage to use analytics.audienceInsights.deviceBreakdown structure
  - Fixed Market Analysis to use analytics.marketBenchmark and analytics.listingInfo structure
  - Fixed Quality Score to use analytics.qualityIndicators structure with proper field names
  - Dashboard summary stats now correctly match and sync with full analytics data
- January 16, 2025. Fixed authentication state refresh after OAuth success:
  - Added checkAuthStatus method to AuthProvider for manual auth state refresh
  - Updated useAuthRedirect hook to call checkAuthStatus after OAuth success
  - Fixed issue where user was successfully logged in but page didn't reload to authenticated view
  - Authentication state now properly updates on frontend after Google OAuth callback
  - Enhanced session management with forced auth status check after OAuth redirect
- January 16, 2025. Verified appointment system security and data filtering:
  - Confirmed appointments are correctly filtered by listing ID and seller ownership
  - API endpoint `/api/listing/:listingId/appointments` properly validates user owns the listing
  - Appointment data structure matches frontend expectations with appointments array and statistics
  - Each seller can only access appointments for their own listings through authentication middleware
  - Database contains correct appointment data: Listing 7 (Jared) has 3 appointments, Listing 8 (Chris) has 3 appointments
  - Authentication required for all appointment endpoints ensures proper data isolation between sellers
- January 16, 2025. Fixed appointment data integrity issues:
  - Removed 3 invalid appointments where sellers were booking with themselves (buyer_id = seller_id)
  - Cleaned appointment data to ensure each listing only shows legitimate buyer interest
  - Listing 7 (Jared's listing): 1 appointment with Chris as buyer
  - Listing 8 (Chris's listing): 2 appointments with Jared as buyer
  - Appointments now properly represent buyer-seller relationships with correct business logic
- January 16, 2025. Fixed React Hooks order violation in ListingDashboard component:
  - Restructured component to ensure all hooks (useState, useQuery, useMutation) are called consistently
  - Moved authentication protection logic after all hooks are defined to comply with Rules of Hooks
  - Added proper authentication guards requiring Google OAuth login for listing dashboard access
  - Fixed database schema issues with seller_blocked_slots table by adding missing columns (is_recurring, recurrence_pattern)
  - Implemented debounced input handling for availability management to prevent excessive database calls
  - Unified reschedule/modify appointment functionality with consistent terminology across buyer and seller interfaces
  - Manage Availability feature now fully functional with weekly schedule management, preferences, and blocked time slots
- January 16, 2025. Enhanced Manage Availability dialog with completion validation:
  - Added validation to prevent dialog from closing until user configures at least one available day and preferences
  - Implemented real-time configuration status indicators with green/red dots showing completion status
  - Added "Save & Close" button that enforces completion requirements before allowing dialog to close
  - Enhanced user experience with clear instructions and status feedback for required configurations
  - Dialog now displays "Configuration Required" warning message when attempting to close without complete setup
  - Visual indicators show: "✓ Weekly schedule configured" and "✓ Preferences configured" when complete
- January 16, 2025. Fixed blocked time slots functionality and database handling:
  - Added proper state management for blocked slot form (start time, end time, reason)
  - Implemented functional "Add Blocked Slot" button with validation and form clearing
  - Fixed input field event handlers and value binding for datetime-local inputs
  - Added validation to require both start and end times before allowing slot creation
  - Enhanced blocked slots display with proper datetime formatting and remove functionality
  - Blocked slots now properly integrate with availability management system
- January 16, 2025. Fixed Manage Availability dialog auto-closing issue:
  - Prevented dialog from closing automatically during form interactions and mutations
  - Dialog now only closes when user explicitly clicks "Save & Close" or "Cancel" buttons
  - Added Cancel button for users to exit without saving changes
  - Enhanced user experience by eliminating unexpected dialog closures during configuration
  - Maintained all validation logic requiring complete setup before saving
- January 16, 2025. Fixed blocked time slots database schema and loading issues:
  - Removed conflicting `seller_id` column from database table (kept `user_id` as per schema)
  - Fixed database constraint error preventing blocked slot creation
  - Blocked slots now load and save properly with correct user association
  - Enhanced blocked slot form with proper validation and state management
  - All appointment availability features now fully functional
- January 16, 2025. Enhanced calendar view with comprehensive full calendar visualization:
  - Implemented react-calendar component for full monthly calendar display
  - Added date highlighting system with color-coded indicators for different date types
  - Blue highlighting for dates with booked appointments
  - Red highlighting for blocked dates/time slots
  - Green highlighting for available dates
  - Purple highlighting for currently selected date
  - Added comprehensive calendar legend showing all date type indicators
  - Enhanced calendar dialog with 3-column layout: full calendar view + detailed day information
  - Added detailed panels showing appointments, blocked times, and statistics for selected dates
  - Fixed Calendar icon conflicts by aliasing lucide-react Calendar as CalendarIcon
  - Added custom CSS styling for calendar tile highlighting with hover effects
  - Calendar now provides visual overview of entire month with clickable date selection
- January 16, 2025. Enhanced appointment management with comprehensive modification capabilities:
  - Fixed database schema issues by adding missing cancellation_reason and completion_notes columns
  - Implemented comprehensive AppointmentActions component with modify, cancel, complete, and reschedule functionality
  - Fixed "Method is not a valid HTTP token" error by correcting apiRequest function calls throughout AppointmentActions
  - Added reschedule button for cancelled appointments that are scheduled in the future
  - Enhanced status display with proper color-coded badges (Cancelled=red, Completed=green, Confirmed=blue, Pending=yellow)
  - Integrated appointment actions into both listing dashboard (sellers) and user profile (buyers)
  - Both buyers and sellers can now modify, cancel, reschedule, and complete appointments with comprehensive validation
  - Real-time appointment updates with proper cache invalidation across all appointment views
  - Unified reschedule functionality: both "Modify" and "Reschedule" buttons now use the same dialog for consistent UX
  - Renamed modify button to "Reschedule" for clearer user understanding and consistent terminology
- January 16, 2025. Implemented comprehensive buyer appointments system:
  - Added "/api/user/buyer-appointments" endpoint to fetch appointments where user is the buyer
  - Created "My Appointments" tab on user profile showing buyer appointments with listing details
  - Added appointment statistics (total, upcoming, pending, completed) to user profile overview
  - Implemented dual-role system: users can be both buyers and sellers
  - Buyer appointments appear on user profile, seller appointments remain on listing dashboards
  - Added comprehensive appointment cards with listing details, seller information, and action buttons
  - Integrated with existing test drive and video call appointment systems
  - API includes appointment statistics, listing details, and seller information for buyer view
- January 16, 2025. Enhanced Google OAuth authentication reliability and session persistence:
  - Added robust retry mechanism for auth status checks after OAuth success with progressive delays
  - Implemented verification polling to ensure authentication state is properly synchronized
  - Added automatic page refresh after successful authentication to guarantee state consistency
  - Enhanced checkAuthStatus function with retry logic and exponential backoff for reliability
  - Fixed authentication persistence issues where OAuth succeeded server-side but client state wasn't updating
  - Improved session management with forced session saves and proper cookie configuration
  - Authentication now reliably persists across page reloads and navigation after Google OAuth success
- January 16, 2025. Fixed dashboard overview statistics data source inconsistency:
  - Updated overview section to use same structured analytics data as Analytics & Insights section
  - Fixed totalViews to use analytics.performanceMetrics.totalViews instead of analytics.totalViews
  - Fixed phoneClicks to use analytics.engagementMetrics.phoneClicks instead of analytics.phoneClicks
  - Fixed favorites to use analytics.engagementMetrics.favorites instead of analytics.favorites
  - Fixed inquiries to use analytics.engagementMetrics.inquiries instead of conversation count
  - Fixed engagement calculation to use analytics.performanceMetrics.clickThroughRate with fallback
  - Dashboard overview statistics now match Analytics & Insights section data exactly
- January 16, 2025. Enhanced Google OAuth authentication reliability and session persistence:
  - Added robust retry mechanism for auth status checks after OAuth success with progressive delays
  - Implemented verification polling to ensure authentication state is properly synchronized
  - Added automatic page refresh after successful authentication to guarantee state consistency
  - Enhanced checkAuthStatus function with retry logic and exponential backoff for reliability
  - Fixed authentication persistence issues where OAuth succeeded server-side but client state wasn't updating
  - Improved session management with forced session saves and proper cookie configuration
  - Authentication now reliably persists across page reloads and navigation after Google OAuth success
- January 16, 2025. Consolidated Analytics & Insights tab into unified single-page view:
  - Removed nested sub-tabs (Performance, Audience, Market, Quality, Keywords) for streamlined experience
  - Consolidated all analytics content into single scrollable page with sectioned analytics display
  - Created unified analytics layout with Performance, Audience, Market, Quality, and Keywords sections
  - Enhanced user experience by eliminating tab navigation complexity in favor of comprehensive single-page view
  - Maintained all analytical insights while reducing cognitive load for high-volume sellers managing multiple listings
- January 16, 2025. Added "Back to Listings" navigation to all dashboard tabs:
  - Added consistent "Back to Listings" links to all four tabs: Overview & Pricing, Messages & Inquiries, Analytics & Insights, and Appointments
  - Positioned navigation links prominently at the top of each tab for easy access
  - Styled with purple-themed buttons matching Gariyangu branding for consistent visual experience
  - Enhanced user navigation flow allowing quick return to My Listings from any dashboard tab
- January 16, 2025. Moved Smart Pricing Intelligence to listing overview for immediate pricing insights:
  - Relocated Smart Pricing Intelligence from separate "Manage & Pricing" tab to main "Overview & Pricing" section
  - Provides immediate pricing insights directly in the overview without requiring tab navigation
  - Enhanced overview section with comprehensive pricing analysis including current price, quick sale, recommended, and premium pricing tiers
  - Added market insights display with key recommendations and "Apply Recommended Price" functionality
  - Renamed "Manage & Pricing" tab to "Manage Listing" to reflect removal of pricing content
  - Updated "Overview" tab to "Overview & Pricing" to indicate integrated pricing intelligence
  - Streamlined user experience with pricing insights prominently displayed alongside listing preview
- January 16, 2025. Consolidated listing management into overview section and removed manage listing tab:
  - Moved listing status management (active/inactive/pending/sold) from separate tab to overview section
  - Moved edit listing and quick actions from manage tab to overview for immediate access
  - Completely removed "Manage Listing" tab to reduce navigation complexity
  - Updated tab layout from 5 tabs to 4 tabs: Overview & Pricing, Messages & Inquiries, Analytics & Insights, Appointments
  - Enhanced overview section with comprehensive listing management including status control and quick actions
  - Consolidated all core listing management functions into single overview tab for streamlined workflow
  - Improved user experience with immediate access to status changes and editing without tab navigation
- January 16, 2025. Fixed Smart Pricing Intelligence critical issues:
  - Fixed SQL syntax errors in seasonal trends query by correcting field name from vehicleCategory to category
  - Enhanced JSON parsing for AI responses with markdown cleanup and better error handling
  - Added comprehensive fallback recommendation system when AI analysis fails
  - Fixed response structure to match frontend expectations with proper pricing tiers (current, recommended, quick sale, premium)
  - Improved error handling for database array storage issues
  - Smart Pricing Intelligence now provides reliable pricing recommendations with market analysis
  - System gracefully handles AI service failures with market-based fallbacks
- January 16, 2025. Fixed recent activity data loading in listing dashboard:
  - Created dedicated recent activity API endpoint `/api/listing/:listingId/recent-activity`
  - Added comprehensive activity tracking from daily_listing_analytics table
  - Recent activity now displays views, phone clicks, favorites, shares, and inquiries with timestamps
  - Enhanced dashboard overview section with real-time activity feed showing user interactions
  - Activities are sorted by timestamp (most recent first) and include location data when available
  - Improved user experience with visual activity indicators using appropriate icons for each activity type
- January 16, 2025. Implemented comprehensive appointment management system:
  - Added three core appointment features: Schedule New Appointment, Manage Availability, and View Calendar
  - Created interactive dialogs for all appointment management functions in listing dashboard
  - Built seller availability management with weekly schedule, time slots, and preferences
  - Implemented blocked time slot functionality for sellers to manage unavailable periods
  - Added appointment scheduling with real-time availability checking and time slot selection
  - Enhanced calendar view showing scheduled appointments and available slots for selected dates
  - Integrated with existing video call and test drive appointment systems for unified management
  - Added comprehensive API queries and mutations for availability, appointments, and blocked slots
  - Authentication-protected features requiring Google OAuth login for all appointment functionality
  - Fixed synchronization issues between frontend appointment creation and seller dashboard display
  - Resolved JavaScript errors with proper array validation and null checks in appointment data
  - Created necessary database tables manually when schema push operations timeout
  - Fixed authentication middleware issues preventing proper appointment data retrieval
  - Corrected data ownership relationships to ensure appointments display for correct listing owners
  - Fixed admin dashboard authentication by ensuring admin user jaredkoyier@gmail.com logged in through Google OAuth
  - Resolved admin listing visibility issues - all 8 car listings now properly display on admin dashboard
  - Fixed admin user data validation errors preventing proper user dropdown population in admin interface
  - Fixed critical appointment API error "Cannot access 'videoCallAppointments2' before initialization" 
  - Resolved variable naming conflicts in appointment endpoint by renaming result variables to avoid schema conflicts
  - Fixed appointment data retrieval for seller dashboards - Chris Otieno can now see his 3 appointments for listing 8
- January 17, 2025. Fixed critical database schema mismatches after schema migration:
  - Migrated from broken full schema to minimal schema architecture to reduce TypeScript errors
  - Fixed car details API endpoint by removing non-existent columns from queries (isActive, isEmailVerified)
  - Updated test_drive_appointments schema to match database (notes → buyerNotes)
  - Removed non-existent columns from car_listings schema (seating, phone_click_count, share_count, inquiry_count, verification_status)
  - Added missing columns to schema that exist in database (color, condition, videos, phone_number, whatsapp_number, is_verified, featured, etc.)
  - Car details page now loads successfully with all data properly mapped from database
- January 17, 2025. Fixed Smart Pricing and integrated financial services:
  - Added missing PUT /api/listings/:id endpoint for updating listing prices
  - Fixed "Apply Recommended Price" button functionality in Smart Pricing Intelligence
  - Formatted market average to display with 2 decimal places (KES 1,234,567.89 format)
  - Created new API endpoint /api/listing/:listingId/loan-applications for sellers to view loan applications
  - Integrated loan applications display in seller dashboard showing client name, phone, bank, product, and status
  - Added comprehensive loan applications table in Overview & Pricing tab with status badges and formatting
- January 17, 2025. Fixed loan applications loading in seller dashboard:
  - Added missing loanApplications, bankPartners, and loanProducts tables to minimal schema
  - Fixed database column mismatch: updated interest_rate to min_interest_rate/max_interest_rate
  - Reorganized dashboard UI: moved loan applications above recent activity for better visibility
  - Integrated edit listing and status controls into listing preview card for consolidated layout
  - Loan applications now display properly with bank name, product name, and client details
  - Created test loan application for listing 7 to verify both listings show applications correctly
- January 17, 2025. Reorganized dashboard UI layout for better user experience:
  - Moved Loan Applications section from Overview & Pricing tab to Messages & Inquiries tab
  - Logical grouping: customer communications and financial inquiries now in same section
  - Improved tab organization with related features grouped together
- January 17, 2025. Consolidated Messages & Appointments into unified tab:
  - Merged Messages & Inquiries tab with Appointments tab to create "Messages & Appointments" tab
  - Combined all communication features: customer messages, loan applications, appointment scheduling, and appointment management
  - Reduced dashboard from 4 tabs to 3 tabs: Overview & Pricing, Messages & Appointments, Analytics & Insights
  - Streamlined seller workflow by consolidating related communication and scheduling functionality in single unified interface
  - Enhanced efficiency for high-volume sellers managing multiple customer interactions and appointment scheduling
- January 17, 2025. Enhanced tab prominence in seller dashboard:
  - Increased tab height from default to 16 (64px) for better visibility
  - Added purple gradient backgrounds for active tabs with white text
  - Implemented larger text size (text-lg) and font-semibold for better readability
  - Added relevant icons: Car for Overview, MessageSquare for Messages, BarChart3 for Analytics
  - Enhanced hover effects with purple background transitions
  - Added border styling and shadow effects for more prominent visual separation
  - Improved spacing and padding for better touch/click targets

## User Preferences

Preferred communication style: Simple, everyday language.